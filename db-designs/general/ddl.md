# Introduction to image api's data design
Image API aims to support multiple databases to suit different requirements for
individual users and enterprizes alike. This document explains the data design
along with the terminologies used.

## Database options available
As of now image api works with following databases:
- SQLite
- MySQL

Support for more database will be added soon!

## Image file persistence and storage options
There are following image storage options available:
- **File System**
  Stores the original image files in the file system. The file is renamed to a
  UUID string generated when the image is uploaded.
- **Database** (coming soon)
  Stores the original image blob in the database itself. The file is stored in
  a table known as "ORIGINAL_IMAGE".

Image API needs to save the original image file somewhere in order to generate
various renditions in the runtime.

## How does image api support multiple databases?
Image api uses the repository pattern along with Data Access Objects (DAO).
This allows image api to support different databases while only requiring a new
DAO to be created to support a different database.

## General terminologies
Let me clarify some of the terminologies used when defining the data:

### Item
Any object in the image api implements the Item trait e.g. Image, User, Folder,
Project etc.

### Slug
A "slug" is a unique string that represents an item. It is generated by the
rust code whenever an item is added to any repository (and hence to the
database).

A slug makes it easier to access an item when used in URL while also being
human readable.

### Image
When we talk about "image" here, we refer to a record in the "IMAGE" table.

### Image File
The original image file that was uploaded by the user.


## General data definitions
Here are some high-level data definitions for the image api.

### USER_ROLE
    || NAME               | TYPE             | NULL | PRIMARY ||
    | ID                  | TINYINT UNSIGNED |      | YES      |
    | ROLE_NAME           | VARCHAR2(32)     |      |          |
    | CREATE_IMAGE        | BOOLEAN          |      |          |
    | READ_IMAGE          | BOOLEAN          |      |          |
    | MODIFY_IMAGE        | BOOLEAN          |      |          |
    | DELETE_IMAGE        | BOOLEAN          |      |          |
    | READ_RENDITIONS     | BOOLEAN          |      |          |
    | CREATE_RENDITIONS   | BOOLEAN          |      |          |
    | MODIFY_RENDITIONS   | BOOLEAN          |      |          |
    | DELETE_RENDITIONS   | BOOLEAN          |      |          |
    | READ_PROJECT        | BOOLEAN          |      |          |
    | CREATE_PROJECT      | BOOLEAN          |      |          |
    | MODIFY_PROJECT      | BOOLEAN          |      |          |
    | DELETE_PROJECT      | BOOLEAN          |      |          |
    | READ_USER           | BOOLEAN          |      |          |
    | CREATE_USER         | BOOLEAN          |      |          |
    | MODIFY_USER         | BOOLEAN          |      |          |
    | DELETE_USER         | BOOLEAN          |      |          |
    | PUBLISH             | BOOLEAN          |      |          |
    | PUBLISH_ALL         | BOOLEAN          |      |          |
    | ACCESS_ALL_PROJECTS | BOOLEAN          |      |          |


### USER
    || NAME         | TYPE              | NULL | PRIMARY ||
    | ID            | SMALLINT UNSIGNED |      | YES      |
    | LOGIN_ID      | VARCHAR(16)       |      |          | UNIQUE
    | EMAIL         | VARCHAR(128)      |      |          | UNIQUE
    | NAME          | VARCHAR(64)       | YES  |          |
    | USER_ROLE     | TINYINT UNSIGNED
    | CREATED_ON    | DATETIME
    | LAST_LOGIN_ON | DATETIME NULL
    
    FOREIGN KEY USER_ROLE:USER_ROLE.ID

### PROJECT
    || NAME         | TYPE              | NULL | PRIMARY ||
    | ID            | SMALLINT UNSIGNED |      | YES      |
    | NAME          | VARCHAR(32)       |      |          |
    | DESCRIPTION   | VARCHAR(256)      |      |          |

### FOLDER
    || NAME            | TYPE              | NULL | PRIMARY ||
    | ID               | SMALLINT UNSIGNED |      | YES      |
    | TITLE            | VARCHAR(128)      |      |          |
    | SLUG             | VARCHAR(128)      |      |          |
    | PROJECT_ID       | SMALLINT UNSIGNED |      |          |
    | DESCRIPTION      | VARCHAR(256)      | YES  |          |
    | PARENT_FOLDER_ID | SMALLINT UNSIGNED | YES  |          |

### IMAGE
    || NAME       | TYPE              | NULL | PRIMARY ||
    | ID          | INT UNSIGNED      |      | YES      |
    | TITLE       | VARCHAR(256)      |      |          |
    | HEIGHT      | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | WIDTH       | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | ENCODING    | SMALLINT UNSIGNED |      |          | DEFAULT 40
    | PUBLISHED   | BOOLEAN           | YES  |          |
    | PROJECT_ID  | SMALLINT UNSIGNED |      |          |
    | FOLDER_ID   | SMALLINT UNSIGNED | YES  |          |
    | CREATED_BY  | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | MODIFIED_BY | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | CREATED_ON  | DATETIME          | YES  |          |
    | MODIFIED_ON | DATETIME          | YES  |          | 

### IMAGE_RENDITION
    || NAME         | TYPE              | NULL | PRIMARY ||
    | ID            | INT UNSIGNED      |      | YES      |
    | IMAGE_ID      | INT UNSIGNED
    | HEIGHT        | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | WIDTH         | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | TARGET_DEVICE | VARCHAR(16)       | YES  |          |
    | ENCODING      | SMALLINT UNSIGNED |      |          | DEFAULT 40
    | SLUG          | VARCHAR(256)      |      |          |
    | PUBLISHED     | BOOLEAN           |      |          | DEFAULT FALSE
    | CREATED_BY    | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | MODIFIED_BY   | SMALLINT UNSIGNED |      |          | DEFAULT 0
    | CREATED_ON    | DATETIME          |      |          | DEFAULT NOW()
    | MODIFIED_ON   | DATETIME          | YES  |          | 

    FOREIGN KEY IMAGE_ID:IMAGE.ID

